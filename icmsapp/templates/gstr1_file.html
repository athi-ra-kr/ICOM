{% extends 'gov1.html' %}
{% block title %}Returns Filing for GST GSTR1{% endblock %}

{% block content %}
<style>
/* --- PAGE RESET & FONTS --- */
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: #f2f4f8;
    font-size: 14px;
    color: #333;
}

/* --- CENTER LAYOUT WRAPPER --- */
.page-wrapper{
    width: 1280px;          /* Fixed width */
    margin: 20px auto;      /* Centered horizontally */
    padding: 0 15px;
}

/* --- BREADCRUMBS --- */
.breadcrumb-bar{
    margin-bottom: 10px;
    font-size: 13px;
    color: #666;
}
.breadcrumb-bar a{ text-decoration: none; color: #2d3b4a; }
.breadcrumb-bar span{ margin: 0 5px; color: #999; }
.breadcrumb-bar strong{ font-weight: 700; color: #000; }

/* --- INFO BAR (Top Metadata) --- */
.info-bar{
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
}
.info-col{
    font-size: 13px;
    line-height: 1.6;
    color: #333;
    font-weight: 600;
}

/* --- MAIN FILING BOX --- */
.main-box{
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 2px;
}

/* TEAL HEADER */
.box-header{
    background: #009688; /* GST Teal */
    color: #fff;
    padding: 12px 20px;
    font-size: 16px;
    font-weight: 500;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.refresh-icon{
    background: #00796b;
    width: 30px; height: 30px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 3px;
    cursor: pointer;
    font-size: 18px;
}

/* FORM AREA */
.form-body{ padding: 25px 30px; }

/* Declaration Checkbox */
.declaration{
    display: flex;
    gap: 12px;
    margin-bottom: 25px;
    align-items: flex-start;
}
.declaration input{ margin-top: 4px; transform: scale(1.1); }
.declaration p{ margin: 0; font-size: 14px; line-height: 1.4; }

/* Dropdown Section */
.form-group{ margin-bottom: 30px; }
.label{ display: block; font-weight: 700; margin-bottom: 8px; font-size: 13px; }
.label span{ color: red; }
select.form-control{
    width: 350px;
    height: 38px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    padding: 5px 10px;
    border-radius: 2px;
    font-size: 14px;
    color: #333;
}

/* Buttons */
.btn-row{
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 40px;
}
.btn{
    padding: 10px 24px;
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    border: none;
    border-radius: 2px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    line-height: 18px;
}
.btn-back{
    background: #fff; color: #333; border: 1px solid #ccc;
}
.btn-dsc{
    background: #607d8b; color: #fff; /* Greyish Blue */
}
.btn-evc{
    background: #3f51b5; color: #fff; /* Indigo Blue */
}
.btn-evc:hover{ background: #303f9f; }

/* DSC FOOTER */
.dsc-box{
    background: #f1f3f6;
    padding: 20px 30px;
    border-top: 1px solid #ddd;
}
.dsc-box h4{
    color: #1a237e;
    margin-bottom: 12px;
    font-size: 14px;
}
.dsc-box ul{ margin: 0; padding-left: 20px; }
.dsc-box li{ margin-bottom: 6px; font-size: 13px; color: #444; }


/* --- MODAL STYLES (CENTERED) --- */
.modal-overlay {
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 2000;
    display: none; /* Hidden by default */
    
    /* FLEX CENTER ALIGNMENT - This puts it in the middle */
    justify-content: center;
    align-items: center; 
}

/* OTP BOX */
.otp-modal {
    background: #fff;
    width: 650px;
    max-width: 90%; 
    border-radius: 4px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    display: flex; flex-direction: column;
    /* Removed large padding/margin to keep it compact */
}
.otp-header {
    padding: 15px 20px;
    border-bottom: 1px solid #ddd;
    color: #283593;
    font-size: 17px;
    font-weight: 600;
}
.otp-body { padding: 20px; }

.green-alert {
    background-color: #e6f4ea;
    border: 1px solid #c7e6cf;
    color: #1e4620;
    padding: 14px;
    font-size: 14px;
    margin-bottom: 20px;
    line-height: 1.4;
}

.otp-label { font-weight: 700; font-size: 14px; display: block; margin-bottom: 8px; }
.otp-input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 15px;
    margin-bottom: 25px;
}

.otp-footer {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
}
.btn-modal {
    padding: 9px 24px;
    border: none;
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    border-radius: 2px;
    text-transform: uppercase;
}
.m-cancel { background: #f5f5f5; border: 1px solid #ccc; color: #333; }
.m-verify { background: #283593; color: white; }
.m-resend { background: #7986cb; color: white; opacity: 0.8; }

.timer-box {
    background: #eee;
    padding: 9px 15px;
    border: 1px solid #ccc;
    font-weight: bold;
    color: #333;
    min-width: 50px;
    text-align: center;
    font-size: 13px;
}

.otp-note {
    font-size: 13px; color: #555; margin-top: 10px;
}

/* SUCCESS MODAL */
.success-box {
    background: white;
    padding: 30px 40px;
    border-radius: 4px;
    text-align: center;
    position: relative;
    width: 500px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.close-x {
    position: absolute; top: 12px; right: 15px;
    font-size: 18px; cursor: pointer; color: #888;
}
.s-flex {
    display: flex; align-items: center; justify-content: flex-start;
    margin-bottom: 8px;
    gap: 15px;
}
.s-icon {
    width: 32px; height: 32px;
    border: 2px solid #2e7d32;
    border-radius: 50%;
    color: #2e7d32;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px; font-weight: bold;
}
.s-title { font-size: 18px; font-weight: 500; color: #333; }
.s-msg { text-align: left; margin-left: 48px; color: #666; font-size: 14px; }
</style>

<div class="page-wrapper">
    <div class="breadcrumb-bar">
        <a href="#">Dashboard</a> <span>›</span>
        <a href="#">Returns</a> <span>›</span>
        <strong>File</strong>
    </div>

    <div class="info-bar">
        <div class="info-col">
            GSTIN - {{ gstin|default:"33BACXM3031K1Z5" }}<br>
            FY - {{ fy|default:"2025-2026" }}
        </div>
        <div class="info-col">
            Legal Name - AKHIL VASUDEV<br>
            Return Period - {{ period|default:"June" }}
        </div>
        <div class="info-col">
            Return Type - GSTR1<br>
            Status - Ready to File
        </div>
    </div>

    <div class="main-box">
        <div class="box-header">
            <span>Returns Filing for GST GSTR1</span>
            <div class="refresh-icon" onclick="location.reload()" title="Refresh">↻</div>
        </div>

        <form method="post" id="filingForm">
            {% csrf_token %}
            <div class="form-body">
                
                <div class="declaration">
                    <input type="checkbox" id="chkDecl" checked>
                    <p>I hereby solemnly affirm and declare that the information given herein above is true and correct to the best of my/our knowledge and belief and nothing has been concealed therefrom.</p>
                </div>

                <div class="form-group">
                    <label class="label">Authorised signatory <span>*</span></label>
                    <select class="form-control" id="signatorySelect">
                        <option value="">Select</option>
                        <option value="Akhil Vasudev">Akhil Vasudev</option>
                    </select>
                </div>

                <div class="btn-row">
                    <a href="{% url 'file_returns_with_id' content_id=content_id %}" class="btn btn-back">BACK</a>
                    
                    <button type="button" class="btn btn-dsc" disabled style="opacity:0.7; cursor: not-allowed;">FILE WITH DSC</button>
                    
                    <button type="button" class="btn btn-evc" onclick="openOtp()">FILE WITH EVC</button>
                </div>
            </div>

            <div class="dsc-box">
                <h4>DSC Usage Steps:</h4>
                <ul>
                    <li>Run the emsigner as Administrator.</li>
                    <li>Open the portal, fill appropriate Details go to Update Register DSC.</li>
                    <li>Open a separate tab in same browser and type https://127.0.0.1:1585</li>
                    <li>Click on Advanced -> Proceed to 127.0.0.1 (Unsafe).</li>
                    <li>Come back to GST portal, refresh the page.</li>
                    <li>Click on register DSC.</li>
                </ul>
            </div>
        </form>
    </div>
</div>

<div id="otpOverlay" class="modal-overlay">
    <div class="otp-modal">
        <div class="otp-header">Validate One Time Password (OTP)</div>
        <div class="otp-body">
            <div class="green-alert">
                One-Time Password (OTP) has been sent to your registered email ID exxxxxxxxxxxxx@gmail.com and mobile no. 93xxxxxx22. OTP is valid Till 16:47
            </div>

            <label class="otp-label">Enter One Time Password (OTP:123456)</label>
            <input type="text" id="otpInput" class="otp-input" placeholder="Enter OTP">

            <div class="otp-footer">
                <button type="button" class="btn-modal m-cancel" onclick="closeOtp()">CANCEL</button>
                <button type="button" class="btn-modal m-verify" onclick="verifyOtp()">VERIFY</button>
                <button type="button" class="btn-modal m-resend">RESEND OTP</button>
                <div class="timer-box" id="timerDisplay">50S</div>
            </div>

            <div class="otp-note">
                If you do not receive the OTP within 30 seconds, please click "RESEND OTP" button to request same OTP again. Resend request can be made maximum three times.
            </div>
        </div>
    </div>
</div>

<div id="successOverlay" class="modal-overlay">
    <div class="success-box">
        <span class="close-x" onclick="closeSuccess()">✕</span>
        <div class="s-flex">
            <div class="s-icon">✓</div>
            <div class="s-title">GSTR1 Return Filing Completed</div>
        </div>
        <div class="s-msg">Please file GSTR3B to complete the task</div>
    </div>
</div>

<script>
    let timerInterval;

    // Open OTP Modal
    function openOtp() {
        const sig = document.getElementById('signatorySelect').value;
        if(sig === "") {
            alert("Please select Authorised Signatory first.");
            return;
        }

        document.getElementById('otpOverlay').style.display = 'flex';
        document.getElementById('otpInput').value = '';
        document.getElementById('otpInput').focus();
        startTimer(50); 
    }

    // Close OTP Modal
    function closeOtp() {
        document.getElementById('otpOverlay').style.display = 'none';
        clearInterval(timerInterval);
    }

    // Timer Logic
    function startTimer(seconds) {
        let timeLeft = seconds;
        const display = document.getElementById('timerDisplay');
        display.textContent = timeLeft + "S";
        
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            display.textContent = timeLeft + "S";
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                display.textContent = "0S";
            }
        }, 1000);
    }

    // Verify OTP Logic
    function verifyOtp() {
        const val = document.getElementById('otpInput').value;
        if(val.trim() === "") {
            alert("Please enter the OTP");
            return;
        }
        closeOtp();
        document.getElementById('successOverlay').style.display = 'flex';
    }

    // Close Success Modal
    function closeSuccess() {
        document.getElementById('successOverlay').style.display = 'none';
    }
</script>
{% endblock %}